load('sp500.mat')
TRANS_HAT = [0 prior'; zeros(size(transition,1),1) transition];
EMIS_HAT = [zeros(1,size(emission,2)); emission];

numStates = 3;
numObservationLabels = 5;

all_samples = zeros(numObservationLabels,size(100:127,2));
correctness = zeros(1,size(100:127,2));

for t = 100:127
    
    %Run [PSTATES, logpseq, Forward, Backward, scale] = hmmdecode(seq, TRANS_HAT, EMIS_HAT) to estimate the Forward probabilities Pt_1 P(Zt?1|Xt?101, ..., Xt?1). Note that Xt?101, ..., Xt?1 are the ground truth observations. get probability distribution prediction for Zt at t=T-1
    %hints:
    %1) the input groundtruth observations: price_change(t-100+1: t)
    %2) The Forward probabilities then can be retrived by
    [PSTATES, logpseq, Forward, Backward, scale] = hmmdecode(price_change(t-100+1: t), TRANS_HAT, EMIS_HAT);
    %=====================A PLACEHOLDER FOR YOUR CODE========================================
    PZt_1 = Forward(:, 101);

    %use transition matrix to get distribution for PZt
    %hints:
    %PZt = dot product of your transition matrix and PZt_1
    PZt = TRANS_HAT' * PZt_1;
    %=====================A PLACEHOLDER FOR YOUR CODE========================================
    %To normalize the probability vector:
    PZt = PZt / sum(PZt);
    
    %Compute the emission probability
    %PEt = dot product of your emission probability matrix and PZt
    PEt = EMIS_HAT' * PZt;
    %=====================A PLACEHOLDER FOR YOUR CODE========================================

    %The prediction is done by sampling from distributions, i.e. the output value Xt is generated by sampling a state zt from P(Zt) and then from P(Xt|Zt = zt). 
    %You don't have to write any code but you should understand the process.
    n_samples = 100; %prediction results over 100 trials
    samples = mnrnd(n_samples, PEt)';
    samplesArray(:,t-100+1) = samples;
    accuracy(t-100+1) = samples(price_change(t+1))/n_samples;
end

mean(accuracy)
var(accuracy)